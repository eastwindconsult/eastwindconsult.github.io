<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="EASTWIND CONSULT WEATHER - Interactive weather map showing precipitation, wind, and pressure">
    <title>EASTWIND CONSULT WEATHER</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    
    <style>
        :root {
            --primary-color: #f36d68;
            --background-dark: #000000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .button-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .forecast-time {
            text-align: center;
            margin-bottom: 10px;
        }

        .controls {
            padding: 8px 15px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            background: #2b2b2b;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .controls:hover {
            background: #404040;
        }

        #capture {
            margin-top: 10px;
            padding: 8px 15px;
            width: 100%;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .logo {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .logo img {
            max-width: 150px;
            height: auto;
        }

        .legend-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
        }

        .legend-title {
            margin-bottom: 10px;
            padding: 5px;
            background: var(--background-dark);
            color: var(--primary-color);
        }

        .legend-scale ul {
            list-style: none;
            padding: 0;
        }

        .legend-scale li {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-scale span {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }

        #loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            display: none;
        }

        .loading #loader {
            display: block;
        }
    </style>
</head>
<body>
    <div id="map">
        <div class="button-container">
            <div class="forecast-time">
                <span id="fcstDate"></span>
                <span id="fcstHour"></span>
                <span id="fcstZone">UTC</span>
            </div>
            <div class="controls-wrapper">
                <button class="controls" id="previous" aria-label="Previous">&lt;</button>
                <button class="controls" id="pause" aria-label="Pause">&#10074;&#10074;</button>
                <button class="controls" id="next" aria-label="Next">&gt;</button>
            </div>
            <button id="capture">Record Forecast</button>
        </div>

        <div class="logo">
            <img src="images/eastwindconsult.png" alt="Eastwind Consult Logo">
        </div>

        <div id="loader">Loading...</div>

        <div class="legend-container">
            <div class="legend-title">
                <marquee scrolldelay="90">
                    We will be launching our China & Australia sites soon! Funded & run by Peter Nunekpeku
                </marquee>
            </div>
            <div class="legend-scale">
                <ul>
                    <li><span style="background:#F2EEF6"></span>Clear Sky</li>
                    <li><span style="background:#40E0D0"></span>Partly Cloudy</li>
                    <li><span style="background:#00bfff"></span>Drizzle</li>
                    <li><span style="background:#68fa07"></span>Rain Showers</li>
                    <li><span style="background:#FFD700"></span>Rain</li>
                    <li><span style="background:#FF6347"></span>Heavy Rain</li>
                    <li><span style="background:#B22222"></span>Thunderstorm</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="js/KML.js"></script>

    <script>
        // Map initialization
        const map = L.map('map', {
            center: [8.50, -1.1],
            zoom: 6,
            minZoom: 0,
            maxZoom: 20,
            maxBounds: [
                [1.082608, -25.84559], // Southwest
                [20.0386, 25.04559]    // Northeast
            ],
            maxBoundsViscosity: 1.0
        });

        // Add tile layer
        L.tileLayer('https://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png', {
            attribution: `
                <a href="https://web.facebook.com/eastwindconsult">EastwindConsult</a> |
                <a href="mailto:eastwindconsultintl@gmail.com">eastwindconsultintl@gmail.com</a> |
                &copy; <a href="https://tileserver.memomaps.de">Memomaps</a> |
                <a href="https://leafletjs.com">Leaflet</a>
            `,
            crossOrigin: true
        }).addTo(map);

        // Remove default prefix
        map.attributionControl.setPrefix('');

        // Add KML Layer
        async function loadKMLLayer() {
            try {
                document.body.classList.add('loading');
                const kmlLayer = new L.KML("/forecast/precslpwind/2023040500/wrf_precslpwind.kml", {async: true});
                await map.addLayer(kmlLayer);
            } catch (error) {
                console.error('Error loading KML layer:', error);
            } finally {
                document.body.classList.remove('loading');
            }
        }

        loadKMLLayer();

        // Error handling for tile loading
        map.on('tileerror', function(e) {
            console.error('Tile loading error:', e);
        });
    </script>
    <script src="js/mykmlanimation2.js"></script>
    <script src="js/record.js"></script>
</body>
</html>
